# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

FRC robot code for Team 7840, 2026 season. Java 17, WPILib command-based architecture with CTRE Phoenix 6 motor control, PathPlanner autonomous, and Limelight vision.

## Build Commands

```bash
./gradlew build              # Compile and run tests
./gradlew test               # Run JUnit 5 tests only
./gradlew simulationDesktop  # Run desktop simulation (no hardware required)
./gradlew deploy             # Deploy to RoboRIO (requires robot network connection)
./gradlew clean              # Clean build artifacts
```

There is no separate lint step. Java code is compiled with standard Gradle/WPILib settings.

## Architecture

### Entry Points
- `Main.java` → `Robot.java` (extends `TimedRobot`, 20 ms loop)
- `RobotContainer.java` wires all subsystems, configures controller bindings, and registers PathPlanner named commands

### Central Configuration
- `Constants.java` (~971 lines) — all hardware CAN IDs, PID gains, geometry, and tuning values live here
- `generated/TunerConstants.java` — auto-generated by CTRE Tuner X; contains swerve module geometry and motor configs. Do not hand-edit.
- `IS_PRACTICE_FIELD` in `Constants.java` — set to `true` at practice venues to adjust AprilTag heights

### Subsystems
Nine subsystems in `subsystems/`:
- `CommandSwerveDrivetrain` — swerve drivetrain on CANivore bus; integrates with VisionSubsystem for pose estimation
- `VisionSubsystem` — Limelight MegaTag2; feeds pose estimates to drivetrain; exposes HUB and TRENCH tag targeting data
- `ShooterSubsystem` — flywheel (velocity) + hood (MotionMagic position); both TalonFX
- `TurretSubsystem` — azimuth rotation with stall-detect homing
- `IntakeSubsystem` — deploy arm (MotionMagic) + roller
- `FeederSubsystem` — feeds balls into shooter; includes stator-current anti-jam
- `SpindexerSubsystem` — ball magazine; includes anti-jam
- `FaultMonitor` — polls all motors for critical faults; surfaces to DriverStation alerts
- `TrenchTraversalManager` — detects TRENCH proximity via VisionSubsystem and auto-stows mechanisms

### Superstructure State Machine
`superstructure/Superstructure.java` is the central coordinator. States: `STOWED → INTAKING → PREPPING_TO_SHOOT → SHOOTING → EXHAUSTING → TRAVERSING_TRENCH`. It commands all scoring subsystems (shooter, turret, intake, feeder, spindexer) based on state transitions and sensor feedback (ball count, readiness flags, anti-jam).

### Commands
`commands/` contains 8 commands. Key ones:
- `ShootCommand` / `AutoShootCommand` — teleop vs. auto shooting with vision feedback
- `HubAlignCommand` — PathPlanner-based approach to hub
- `HomeTurretCommand` — stall-detect homing routine
- `IntakeUnderTrenchCommand` / `PassThroughTrenchCommand` — TRENCH-specific behaviors

### Vision Pipeline
`VisionSubsystem.periodic()` reads Limelight NetworkTables, provides gyro yaw to MegaTag2, filters estimates by rotation rate and tag count, then calls `CommandSwerveDrivetrain.addVisionMeasurement()`.

### Autonomous
PathPlanner 2026 autos. Named commands (`Intake`, `Shoot`, `PassThroughTrench`, `IntakeUnderTrench`) are registered in `RobotContainer`. Auto chooser is published to SmartDashboard.

### Logging
- Phoenix 6 `SignalLogger` writes `.hoot` files to `./logs/example.hoot`
- WPILib `DataLogManager` runs in parallel
- `Telemetry.java` publishes swerve state to NetworkTables
- `HootAutoReplay` enables deterministic log replay for post-match analysis

## Key Hardware
- **CAN bus:** `"CANivore"` (CTRE CANivore interface) for all drive/shooter motors
- **Gyro:** Pigeon 2, CAN ID 1
- **Motors:** CTRE TalonFX (Kraken X60 / Falcon 500)
- **Max drive speed:** 4.54 m/s @ 12V
- **Vision:** Limelight (MegaTag2 mode)

## SysId / Characterization
Routines are accessible via SmartDashboard "Mechanism SysId Routine" chooser. Triggered via controller: `Back/Start + POV Left/Right` or `Back/Start + Y/X`. Covers drivetrain, flywheel, hood, turret, intake deploy, feeder, and spindexer.
